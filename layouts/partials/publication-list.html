{{ $papers := .Site.Data.publications.papers }}
{{ $sorted := sort $papers "year" "desc" }}

<div class="publications-container">
    {{ range $sorted }}
    <article class="publication-card">
        <div class="pub-year">{{ .year }}</div>
        <div class="pub-content">
            <h3 class="pub-title">{{ .title | markdownify }}</h3>
            <div class="pub-meta">{{ .authors }}</div>
            <div class="pub-journal">{{ .journal }}</div>

            {{ if .abstract }}
            <p class="pub-abstract">{{ .abstract }}</p>
            {{ end }}

            <div class="pub-actions">
                {{ if .pdf_url }}
                <a href="{{ .pdf_url }}" class="pub-btn" target="_blank">PDF</a>
                {{ end }}
                {{ if .code_url }}
                <a href="{{ .code_url }}" class="pub-btn" target="_blank">Code</a>
                {{ end }}
                <button class="pub-btn cite-toggle" onclick="toggleCite(this)">Cite</button>
            </div>

            <div class="bibtex-block" style="display: none;">
                <pre><code>{{ .bibtex | htmlEscape }}</code></pre>
            </div>
        </div>
    </article>
    {{ end }}
</div>

<script>
    function toggleCite(button) {
        const bibtexBlock = button.closest('.publication-card').querySelector('.bibtex-block');
        if (bibtexBlock.style.display === 'none') {
            bibtexBlock.style.display = 'block';
            button.textContent = 'Hide Citation';
        } else {
            bibtexBlock.style.display = 'none';
            button.textContent = 'Cite';
        }
    }
</script>